<!DOCTYPE html>
<html>
<head>
    <title>Upload Image</title>
</head>
<body>
    <h1>Upload Image</h1>
    <form action="/upload" method="post" enctype="multipart/form-data" novalidate>
        <input type="file" name="image" accept="image/*" required>
        <input type="submit" value="Upload">
    </form>

    

    <script>
       function scaleImage(file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var img = new Image();
                img.onload = function() {
                    var canvas = document.createElement('canvas');
                    var ctx = canvas.getContext('2d');

                    const targetWidth = 1920;
                    const targetHeight = 1080;

                    let width = img.width;
                    let height = img.height;

                    // Keep aspect ratio
                    if (width > height) {
                        if (width > targetWidth) {
                            height = height * (targetWidth / width);
                            width = targetWidth;
                        }
                    } else {
                        if (height > targetHeight) {
                            width = width * (targetHeight / height);
                            height = targetHeight;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;

                    ctx.drawImage(img, 0, 0, width, height);
                    var dataUrl = canvas.toDataURL('image/jpeg');
                    console.log(dataUrl);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function uploadFile(file) {
            var formData = new FormData();
            formData.append("image", file);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/upload', true);
            xhr.onload = function() {
                if (xhr.status === 200) {
                    console.log('Upload successful');
                } else {
                    console.log('Upload failed');
                }
            };

            xhr.send(formData);
        }

        document.querySelector('input[type="file"]').addEventListener('change', function(e) {
            var file = e.target.files[0];
            scaleImage(file);
            uploadFile(file);
        });
    </script>
</body>
</html>


