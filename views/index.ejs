<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/styles/styles.css">
  <link rel="shortcut icon" href="#">
  <title>Gallery View 3</title>
  <style>
    body,
    html {
      height: 100%;
      /* Full viewport height */
      margin: 0;
      /* Remove default margin */
      position: relative;
      /* Positioning context for centering */
      overflow: hidden;
      /* Optional: depends on design needs */
      background-color: black;
    }

    .carousel {
      width: 100%;
      max-width: 1280px;
      /* Maximum width of the carousel */
      height: 720px;
      /* Fixed height */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      /* Center the carousel */
      overflow: hidden;
    }

    .slide {
      position: absolute;
      width: 100%;
      height: 100%;
      /* Full height of the carousel */
      top: 0;
      left: 0;
      /* Align to the left */
      display: none;
      /* Hide by default, show via JavaScript */
    }

    .slide img {
      width: 100%;
      /* Full width to match the slide */
      height: 100%;
      /* Full height to match the slide */
    }
  </style>
</head>

<body>
  <div class="carousel">
    <% images.forEach((image, index)=> { %>
      <div class='slide'><img src='/public/uploads/<%= image %>' alt='Image'></div>
      <% }); %>
  </div>

  <script>
    function updateCarousel(images) {
      const carousel = document.querySelector('.carousel');
      carousel.innerHTML = ''; // Clear the carousel
      images.forEach(image => {
        const slide = document.createElement('div');
        slide.className = 'slide';
        const img = document.createElement('img');
        img.src = '/public/uploads/' + image.name; // Assuming 'image' is an object with a 'name' property
        img.alt = 'Image';
        slide.appendChild(img);
        carousel.appendChild(slide);
      });

      const slides = document.querySelectorAll('.slide');
      let slideIndex = 0;

      // Reset existing intervals before setting a new one
      if (window.carouselInterval) {
        clearInterval(window.carouselInterval);
      }

      if (slides.length > 0) {
        slides[0].style.display = 'block'; // Show the first slide initially

        window.carouselInterval = setInterval(() => {
          for (let i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none'; // Hide all slides
          }
          slideIndex = (slideIndex + 1) % slides.length; // Move to next slide index
          slides[slideIndex].style.display = 'block'; // Display the next slide
        }, 10000); // Rotate slides every 10 seconds
      }
    }
    //initial call to updateCarousel
    fetch('/images')
      .then(response => response.json())
      .then(images => updateCarousel(images));

    setInterval(() => {
      fetch('/images')
        .then(response => response.json())
        .then(images => updateCarousel(images));
    }, 160000); // Fetch new images to update the carousel every 160 seconds


  </script>
</body>

</html>